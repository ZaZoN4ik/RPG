<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monster Clicker RPG</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #09090b;
            --card-bg: #18181b;
            --text-color: #e4e4e7;
            --accent-color: #f59e0b; /* Amber */
            --danger-color: #ef4444; /* Red */
            --success-color: #22c55e; /* Green */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ --- */
        .header {
            background: rgba(24, 24, 27, 0.9);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #27272a;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .resource-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .resource-label { font-size: 10px; color: #71717a; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .resource-val { font-size: 16px; font-weight: 800; color: var(--accent-color); }
        .lvl-badge {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            padding: 4px 10px;
            border-radius: 8px;
            font-weight: 800;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
        }

        /* --- –ê–†–ï–ù–ê (–¶–µ–Ω—Ç—Ä) --- */
        .arena {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, #27272a 0%, #09090b 70%);
        }

        /* –ú–æ–Ω—Å—Ç—Ä */
        .monster-wrapper {
            position: relative;
            cursor: pointer;
            transition: transform 0.05s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .monster-wrapper:active { transform: scale(0.9); }

        .monster-emoji {
            font-size: 110px;
            filter: drop-shadow(0 0 30px rgba(0,0,0,0.5));
            animation: breathe 3s infinite ease-in-out;
            z-index: 2;
        }

        /* –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è */
        .hp-container {
            width: 70%;
            margin-top: 20px;
            text-align: center;
        }

        .hp-bar-bg {
            background: #27272a;
            height: 14px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #3f3f46;
            position: relative;
        }

        .hp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f87171);
            width: 100%;
            transition: width 0.1s linear;
        }

        .hp-text {
            margin-top: 6px;
            font-size: 12px;
            color: #a1a1aa;
            font-weight: 600;
        }

        .monster-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* --- –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ (–ú–∞–≥–∞–∑–∏–Ω) --- */
        .footer {
            background: var(--card-bg);
            height: 35%;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 14px;
            color: #71717a;
            margin-bottom: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .upgrades-list {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π */
        .upgrade-card {
            background: #27272a;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .upgrade-card:active { transform: scale(0.98); background: #3f3f46; }

        .upgrade-card.disabled {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .icon { font-size: 24px; margin-right: 12px; background: #3f3f46; padding: 8px; border-radius: 10px; }

        .info { flex: 1; }
        .name { font-weight: bold; font-size: 14px; display: block; }
        .desc { font-size: 11px; color: #a1a1aa; display: block; margin-top: 2px; }

        .price-btn {
            background: var(--accent-color);
            color: #000;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 800;
            font-size: 12px;
            text-align: center;
            min-width: 60px;
        }

        /* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
        }

        .damage-number {
            position: absolute;
            color: white;
            font-weight: 900;
            font-size: 28px;
            pointer-events: none;
            animation: floatUp 0.6s ease-out forwards;
            text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000; /* –û–±–≤–æ–¥–∫–∞ */
            z-index: 10;
        }

        .crit {
            color: #ef4444;
            font-size: 40px;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #52525b; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="lvl-badge">LVL <span id="ui-level">1</span></div>
        <div class="resource-box">
            <span class="resource-label">DPS (–£—Ä–æ–Ω/—Å–µ–∫)</span>
            <span class="resource-val" style="color: #fff">‚öîÔ∏è <span id="ui-dps">0</span></span>
        </div>
        <div class="resource-box">
            <span class="resource-label">–ó–æ–ª–æ—Ç–æ</span>
            <span class="resource-val">üí∞ <span id="ui-gold">0</span></span>
        </div>
    </div>

    <div class="arena" id="arena-container">
        <div class="monster-name" id="ui-monster-name">–°–ª–∏–∑–µ–Ω—å</div>

        <div class="monster-wrapper" id="monster-click-zone">
            <div class="monster-emoji" id="ui-monster-emoji">ü¶†</div>
        </div>

        <div class="hp-container">
            <div class="hp-bar-bg">
                <div class="hp-bar-fill" id="ui-hp-bar"></div>
            </div>
            <div class="hp-text"><span id="ui-hp-cur">10</span> / <span id="ui-hp-max">10</span> HP</div>
        </div>
    </div>

    <div class="footer">
        <div class="section-title">–ú–∞–≥–∞–∑–∏–Ω —É–ª—É—á—à–µ–Ω–∏–π</div>
        <div class="upgrades-list">

            <div class="upgrade-card" id="btn-upg-dmg" onclick="buyUpgrade('clickDmg')">
                <div class="icon">‚öîÔ∏è</div>
                <div class="info">
                    <span class="name">–û—Å—Ç—Ä—ã–π –º–µ—á</span>
                    <span class="desc">+1 –∫ —É—Ä–æ–Ω—É –∑–∞ –∫–ª–∏–∫</span>
                </div>
                <div class="price-btn" id="price-clickDmg">10</div>
            </div>

            <div class="upgrade-card" id="btn-upg-auto" onclick="buyUpgrade('autoDmg')">
                <div class="icon">ü§ñ</div>
                <div class="info">
                    <span class="name">–ù–∞–µ–º–Ω–∏–∫</span>
                    <span class="desc">+2 —É—Ä–æ–Ω–∞ –≤ —Å–µ–∫—É–Ω–¥—É</span>
                </div>
                <div class="price-btn" id="price-autoDmg">50</div>
            </div>

            <div class="upgrade-card" id="btn-upg-crit" onclick="buyUpgrade('critChance')">
                <div class="icon">‚ö°</div>
                <div class="info">
                    <span class="name">–£–¥–∞—á–∞</span>
                    <span class="desc">+5% —à–∞–Ω—Å –∫—Ä–∏—Ç. —É–¥–∞—Ä–∞</span>
                </div>
                <div class="price-btn" id="price-critChance">100</div>
            </div>

        </div>
    </div>

    <script>
        // --- 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM ---
        const tg = window.Telegram.WebApp;
        tg.expand(); // –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.disableVerticalSwipes(); // –ó–∞–ø—Ä–µ—Ç —Å–≤–∞–π–ø–æ–≤ (—á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã—Ç—å —Å–ª—É—á–∞–π–Ω–æ)

        // --- 2. –î–ê–ù–ù–´–ï –ò–ì–†–´ (CONFIG) ---
        const GAME_DATA = {
            player: {
                gold: 0,
                clickDmg: 1,
                autoDmg: 0,
                critChance: 0,
                level: 1
            },
            currentMonster: {
                hp: 15,
                maxHp: 15,
                id: 0
            },
            prices: {
                clickDmg: 10,
                autoDmg: 50,
                critChance: 100
            }
        };

        const MONSTERS_DB = [
            { name: "–°–ª–∏–∑–µ–Ω—å", emoji: "ü¶†" },
            { name: "–ì–æ–±–ª–∏–Ω", emoji: "üëπ" },
            { name: "–°–∫–µ–ª–µ—Ç", emoji: "üíÄ" },
            { name: "–û—Ä–∫", emoji: "üë∫" },
            { name: "–í–æ–ª–∫", emoji: "üê∫" },
            { name: "–ü—Ä–∏–∑—Ä–∞–∫", emoji: "üëª" },
            { name: "–í–∞–º–ø–∏—Ä", emoji: "üßõ" },
            { name: "–î—Ä–∞–∫–æ–Ω", emoji: "üê≤" },
            { name: "–î–µ–º–æ–Ω", emoji: "üòà" },
            { name: "–ö—Ç—É–ª—Ö—É", emoji: "üêô" }
        ];

        // --- 3. –ó–ê–ì–†–£–ó–ö–ê / –°–û–•–†–ê–ù–ï–ù–ò–ï ---
        function loadGame() {
            const saved = localStorage.getItem('rpg_save_v1');
            if (saved) {
                const parsed = JSON.parse(saved);
                GAME_DATA.player = parsed.player;
                GAME_DATA.prices = parsed.prices;
                // –ú–æ–Ω—Å—Ç—Ä–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–ª–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º, –ª—É—á—à–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Ä–æ–≤–Ω—è
                generateMonster(false);
            } else {
                generateMonster(true);
            }
            updateUI();
        }

        function saveGame() {
            localStorage.setItem('rpg_save_v1', JSON.stringify({
                player: GAME_DATA.player,
                prices: GAME_DATA.prices
            }));
        }

        // --- 4. –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---

        function generateMonster(resetHp) {
            // –ú–æ–Ω—Å—Ç—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è –∏–≥—Ä–æ–∫–∞
            const index = (GAME_DATA.player.level - 1) % MONSTERS_DB.length;
            const template = MONSTERS_DB[index];

            // –°–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ HP: 15 * 1.3 ^ (level-1)
            const newMaxHp = Math.floor(15 * Math.pow(1.25, GAME_DATA.player.level - 1));

            GAME_DATA.currentMonster.maxHp = newMaxHp;
            if (resetHp) GAME_DATA.currentMonster.hp = newMaxHp;

            // UI
            document.getElementById('ui-monster-emoji').textContent = template.emoji;
            document.getElementById('ui-monster-name').textContent = `Lvl ${GAME_DATA.player.level} ${template.name}`;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        document.getElementById('monster-click-zone').addEventListener('touchstart', (e) => {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑—É–º –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            e.preventDefault();
            // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏—Ç–∞—á–∞ (–≤—Å–µ –ø–∞–ª—å—Ü—ã –Ω–∞–Ω–æ—Å—è—Ç —É—Ä–æ–Ω)
            for (let i = 0; i < e.changedTouches.length; i++) {
                handleHit(e.changedTouches[i].clientX, e.changedTouches[i].clientY);
            }
        }, { passive: false });

        // –î–ª—è –º—ã—à–∫–∏ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ü–ö)
        document.getElementById('monster-click-zone').addEventListener('mousedown', (e) => {
            handleHit(e.clientX, e.clientY);
        });

        function handleHit(x, y) {
            // 1. –†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞
            let dmg = GAME_DATA.player.clickDmg;
            let isCrit = Math.random() * 100 < GAME_DATA.player.critChance;
            if (isCrit) dmg *= 2;

            applyDamage(dmg);

            // 2. –í–∏–∑—É–∞–ª
            spawnDamageNumber(x, y, dmg, isCrit);
            animateMonster();

            // 3. –í–∏–±—Ä–∞—Ü–∏—è (Haptic)
            if (isCrit) tg.HapticFeedback.notificationOccurred('success');
            else tg.HapticFeedback.impactOccurred('medium');
        }

        function applyDamage(amount) {
            GAME_DATA.currentMonster.hp -= amount;

            if (GAME_DATA.currentMonster.hp <= 0) {
                GAME_DATA.currentMonster.hp = 0;
                onMonsterDeath();
            }
            updateUI();
        }

        function onMonsterDeath() {
            // –ù–∞–≥—Ä–∞–¥–∞: 2 + 10% –æ—Ç –º–∞–∫—Å HP
            const goldReward = Math.floor(2 + (GAME_DATA.currentMonster.maxHp * 0.1));
            GAME_DATA.player.gold += goldReward;
            GAME_DATA.player.level++;

            // –°–±—Ä–æ—Å –º–æ–Ω—Å—Ç—Ä–∞
            generateMonster(true);
            saveGame();

            // –≠—Ñ—Ñ–µ–∫—Ç
            tg.HapticFeedback.notificationOccurred('success');
        }

        function buyUpgrade(type) {
            const price = GAME_DATA.prices[type];
            if (GAME_DATA.player.gold >= price) {
                // –ü–æ–∫—É–ø–∫–∞
                GAME_DATA.player.gold -= price;

                // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–∫—É–ø–∫–∏
                if (type === 'clickDmg') {
                    GAME_DATA.player.clickDmg += 1;
                    GAME_DATA.prices.clickDmg = Math.ceil(price * 1.5);
                } else if (type === 'autoDmg') {
                    GAME_DATA.player.autoDmg += 2;
                    GAME_DATA.prices.autoDmg = Math.ceil(price * 1.4);
                } else if (type === 'critChance') {
                    GAME_DATA.player.critChance += 5;
                    GAME_DATA.prices.critChance = Math.ceil(price * 2);
                }

                saveGame();
                updateUI();
                tg.HapticFeedback.selectionChanged();
            } else {
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        // –ê–≤—Ç–æ-—É—Ä–æ–Ω (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
        setInterval(() => {
            if (GAME_DATA.player.autoDmg > 0 && GAME_DATA.currentMonster.hp > 0) {
                applyDamage(GAME_DATA.player.autoDmg);
                // –ú–∞–ª–µ–Ω—å–∫–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ-—É—Ä–æ–Ω–∞ (—Ü–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞)
                // spawnDamageNumber(window.innerWidth/2, window.innerHeight/2 - 50, GAME_DATA.player.autoDmg, false);
            }
        }, 1000);

        // --- 5. UI –ú–ï–ù–ï–î–ñ–ï–† ---

        function updateUI() {
            // –®–∞–ø–∫–∞
            document.getElementById('ui-gold').textContent = GAME_DATA.player.gold;
            document.getElementById('ui-dps').textContent = GAME_DATA.player.autoDmg;
            document.getElementById('ui-level').textContent = GAME_DATA.player.level;

            // HP –±–∞—Ä
            const hpPercent = (GAME_DATA.currentMonster.hp / GAME_DATA.currentMonster.maxHp) * 100;
            document.getElementById('ui-hp-bar').style.width = `${hpPercent}%`;
            document.getElementById('ui-hp-cur').textContent = GAME_DATA.currentMonster.hp;
            document.getElementById('ui-hp-max').textContent = GAME_DATA.currentMonster.maxHp;

            // –¶–µ–Ω—ã –∫–Ω–æ–ø–æ–∫ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
            updateBtnState('btn-upg-dmg', 'price-clickDmg', 'clickDmg');
            updateBtnState('btn-upg-auto', 'price-autoDmg', 'autoDmg');
            updateBtnState('btn-upg-crit', 'price-critChance', 'critChance');
        }

        function updateBtnState(btnId, priceId, type) {
            const price = GAME_DATA.prices[type];
            const btn = document.getElementById(btnId);
            document.getElementById(priceId).textContent = price;

            if (GAME_DATA.player.gold >= price) {
                btn.classList.remove('disabled');
            } else {
                btn.classList.add('disabled');
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏–∏
        function spawnDamageNumber(x, y, dmg, isCrit) {
            const el = document.createElement('div');
            el.textContent = dmg;
            el.className = 'damage-number';
            if (isCrit) el.classList.add('crit');

            // –†–∞–Ω–¥–æ–º–Ω—ã–π —Ä–∞–∑–±—Ä–æ—Å
            const offsetX = (Math.random() - 0.5) * 40;
            el.style.left = `${x + offsetX}px`;
            el.style.top = `${y - 50}px`;

            document.body.appendChild(el);
            setTimeout(() => el.remove(), 600);
        }

        function animateMonster() {
            const m = document.getElementById('ui-monster-emoji');
            m.style.transform = "scale(0.85)";
            setTimeout(() => m.style.transform = "scale(1)", 100);
        }

        // –°—Ç–∞—Ä—Ç
        loadGame();
    </script>
</body>
</html>